<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Astro App</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: sans-serif;
}

/* canvas glow */
canvas {
    filter: brightness(1.2) contrast(1.2);
}

/* UI panel */
.ui {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 10;
    background: rgba(0,0,30,0.7);
    padding: 15px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    color: white;
    width: 220px;
}

.ui input, .ui button {
    width: 100%;
    margin-top: 5px;
    padding: 5px;
}

/* popup */
.popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    border: 1px solid gold;
    padding: 20px;
    display: none;
    color: white;
    max-width: 300px;
    text-align: center;
}

.popup button {
    margin-top: 10px;
}

/* mobile */
@media (max-width: 600px) {
    .ui {
        width: 90%;
        left: 5%;
    }
}
</style>

</head>
<body>

<div class="ui">
    <h3>üîÆ ·É∞·Éù·É†·Éù·É°·Éô·Éù·Éû·Éò</h3>

    <input type="date" id="birthdate">
    <input type="time" id="birthtime">
    <input type="text" id="birthplace" placeholder="·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éê·Éì·Éí·Éò·Éö·Éò">

    <button onclick="loadHoroscope()">·Éí·Éê·Éí·Éî·Éë·Éê</button>
</div>

<div id="popup" class="popup">
    <h2 id="signName"></h2>
    <p id="horoscopeText"></p>
    <button onclick="closePopup()">·Éì·Éê·ÉÆ·É£·É†·Éï·Éê</button>
</div>

<script>

// -------------------- THREE SETUP --------------------

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 20;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// -------------------- STARS --------------------

const particles = new THREE.BufferGeometry();
const count = 8000;
const positions = [];

for (let i = 0; i < count; i++) {
    positions.push((Math.random()-0.5)*200);
    positions.push((Math.random()-0.5)*200);
    positions.push((Math.random()-0.5)*200);
}

particles.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

const material = new THREE.PointsMaterial({
    size: 0.5,
    color: 0xffffff
});

const stars = new THREE.Points(particles, material);
scene.add(stars);

// -------------------- SUN --------------------

const sun = new THREE.Mesh(
    new THREE.SphereGeometry(2, 32, 32),
    new THREE.MeshBasicMaterial({color: 0xffaa00})
);
scene.add(sun);

// -------------------- PLANETS --------------------

const planets = [];

function createPlanet(radius, size, color, speed) {
    const mesh = new THREE.Mesh(
        new THREE.SphereGeometry(size, 16, 16),
        new THREE.MeshBasicMaterial({color})
    );

    scene.add(mesh);

    planets.push({mesh, radius, angle: Math.random()*Math.PI*2, speed});
}

createPlanet(4, 0.5, 0x00aaff, 0.01);
createPlanet(6, 0.7, 0xff0000, 0.008);
createPlanet(8, 0.9, 0x00ff00, 0.006);

// -------------------- ZODIAC --------------------

const signs = [
"‚ôà","‚ôâ","‚ôä","‚ôã","‚ôå","‚ôç",
"‚ôé","‚ôè","‚ôê","‚ôë","‚ôí","‚ôì"
];

const zodiac = [];

function createText(text) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    ctx.font = "40px Arial";
    ctx.fillStyle = "white";
    ctx.fillText(text, 10, 40);

    const texture = new THREE.CanvasTexture(canvas);
    const material = new THREE.SpriteMaterial({map: texture});

    const sprite = new THREE.Sprite(material);
    sprite.scale.set(2,2,1);

    return sprite;
}

signs.forEach((s, i) => {
    const sprite = createText(s);

    const angle = (i / 12) * Math.PI * 2;

    sprite.position.x = Math.cos(angle)*12;
    sprite.position.y = Math.sin(angle)*12;

    scene.add(sprite);

    zodiac.push({sprite, angle});
});

// -------------------- HOROSCOPE API --------------------

async function fetchHoroscope(sign) {
    try {
        const res = await fetch(`https://aztro.sameerkumar.website/?sign=${sign}&day=today`, {
            method: "POST"
        });

        const data = await res.json();

        return data.description;

    } catch {
        return "·Éì·É¶·Éî·É° ·Éô·Éê·É†·Éí·Éò ·Éî·Éú·Éî·É†·Éí·Éò·Éê ·Éí·Éê·É•·Éï·É°. ·Éî·Éú·Éì·Éî ·É°·Éê·Éô·É£·Éó·Éê·É† ·Éó·Éê·Éï·É°.";
    }
}

// -------------------- ZODIAC CALC --------------------

function getZodiac(date) {
    const d = new Date(date);
    const m = d.getMonth()+1;
    const day = d.getDate();

    if ((m==3 && day>=21)||(m==4&&day<=19)) return "aries";
    if ((m==4 && day>=20)||(m==5&&day<=20)) return "taurus";
    if ((m==5 && day>=21)||(m==6&&day<=20)) return "gemini";
    if ((m==6 && day>=21)||(m==7&&day<=22)) return "cancer";
    if ((m==7 && day>=23)||(m==8&&day<=22)) return "leo";
    if ((m==8 && day>=23)||(m==9&&day<=22)) return "virgo";
    if ((m==9 && day>=23)||(m==10&&day<=22)) return "libra";
    if ((m==10 && day>=23)||(m==11&&day<=21)) return "scorpio";
    if ((m==11 && day>=22)||(m==12&&day<=21)) return "sagittarius";
    if ((m==12 && day>=22)||(m==1&&day<=19)) return "capricorn";
    if ((m==1 && day>=20)||(m==2&&day<=18)) return "aquarius";
    if ((m==2 && day>=19)||(m==3&&day<=20)) return "pisces";
}

// -------------------- UI --------------------

function show(text, sign) {
    document.getElementById("signName").innerText = sign;
    document.getElementById("horoscopeText").innerText = text;
    document.getElementById("popup").style.display = "block";
}

function closePopup() {
    document.getElementById("popup").style.display = "none";
}

// -------------------- LOAD --------------------

async function loadHoroscope() {
    const date = document.getElementById("birthdate").value;

    if (!date) {
        alert("·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî ·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò");
        return;
    }

    const sign = getZodiac(date);

    const text = await fetchHoroscope(sign);

    show(text, sign.toUpperCase());
}

// -------------------- ANIMATION --------------------

function animate() {
    requestAnimationFrame(animate);

    stars.rotation.y += 0.0005;

    planets.forEach(p => {
        p.angle += p.speed;
        p.mesh.position.x = Math.cos(p.angle)*p.radius;
        p.mesh.position.y = Math.sin(p.angle)*p.radius;
    });

    renderer.render(scene, camera);
}

animate();

// -------------------- RESPONSIVE --------------------

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

</script>

</body>
</html>
